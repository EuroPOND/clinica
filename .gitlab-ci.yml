# Continous Integration Scrip
# Clinica - ARAMIS
#
stages:
  - build
  - install
  - test
  - deploy

    #variables:
    #  BIDS_TEST: "/localdrive10TB/data/gitlab-runner/BIDS_TEST"
    #  CAPS_TEST: "/localdrive10TB/data/gitlab-runner/CAPS_TEST"
    #  WD_TEST: "/localdrive10TB/data/gitlab-runner/WD_TEST"
    #  ENVIRONMENT_TEST: "/export/applications/clinica/Ubuntu14.04/dot_path"

before_script:
  - pwd
after_script:
  #  - conda env remove -y  --name clinica_env

build:mac:
  stage: build
  tags:
    - macOS
  script:
    - conda env create --force --file environment.yml

build:linux:
  stage: build
  tags:
    - linux
  script:
    - conda env create --force --file environment.yml

install:mac:
  # Install python dependencies for  Clinica 
  stage: install 
  tags:
    - install
    - macOS
  script:
    - source activate clinica_env
    - pip install -e .
    - eval "$(register-python-argcomplete clinica)"
    - clinica --help
    - source deactivate
  

install:linux:
  # Install python dependencies for  Clinica 
  stage: install
  tags:
    - install
    - linux
  script:
    - source activate clinica_env
    - pip install -e .
    - eval "$(register-python-argcomplete clinica)"
    - clinica --help
    - source deactivate

test_spm_full_prep:linux:
  stage: test
  tags:
    - linux
  script:
    - source activate clinica_env
    - clinica --help
    - source deactivate

